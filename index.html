<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Tuấn ♥️ Nga — Happy Birthday</title>
<style>
  :root { --pink:#ff6fbf; --violet:#bf7bff; }
  html,body{height:100%;margin:0;background:#000;overflow:hidden;font-family:Inter, "Segoe UI", Roboto, Arial, sans-serif;}
  #app { position:fixed; inset:0; display:block; }
  canvas{ display:block; width:100%; height:100%; }

  /* Center text (will be hidden from pointer events) */
  #centerText{
    position:absolute;
    left:50%;
    top:50%;
    transform:translate(-50%,-50%);
    text-align:center;
    color:var(--pink);
    text-shadow:0 6px 20px rgba(191,123,255,0.12), 0 2px 8px rgba(255,107,191,0.12);
    pointer-events:none;
    z-index:4;
    width:86%;
    max-width:760px;
    line-height:1.4;
  }
  #centerText h1{ margin:0 0 8px; font-size:22px; letter-spacing:0.4px; color: #ffd9ee;}
  #centerText p{ margin:4px 0; font-size:15px; color:#ffd7ee; opacity:0.95; }

  /* Circular rotating text below (3.5s per revolution) */
  .circle-wrap {
    position:absolute;
    left:50%;
    bottom:6vh;
    transform:translateX(-50%);
    width:min(760px,92vw);
    height:160px;
    pointer-events:none;
    z-index:4;
    overflow:visible;
  }
  .rotater {
    width:100%;
    height:100%;
    transform-origin:center center;
    animation:spinText 3.5s linear infinite;
    will-change:transform;
  }
  @keyframes spinText { from{transform:rotate(0deg)} to{transform:rotate(360deg)} }

  .rotater span {
    position:absolute;
    left:50%;
    top:50%;
    transform-origin: -260px 0; /* distance (radius) - adjust if needed */
    font-weight:600;
    color:var(--pink);
    text-shadow:0 2px 10px rgba(191,123,255,0.18);
    white-space:nowrap;
    font-size:16px;
    letter-spacing:0.2px;
  }

  /* Music button (shows only if autoplay blocked) */
  #musicBtn {
    position:fixed;
    right:14px;
    bottom:14px;
    z-index:20;
    display:flex;
    gap:8px;
    align-items:center;
    padding:8px 12px;
    font-size:14px;
    color:#fff;
    background:linear-gradient(135deg, rgba(255,110,180,0.12), rgba(150,90,200,0.06));
    border-radius:10px;
    border:1px solid rgba(255,255,255,0.06);
    cursor:pointer;
    backdrop-filter:blur(4px);
  }
  #musicBtn.hidden { display:none; }

  /* small responsive tweak */
  @media (max-width:520px){
    .rotater span { font-size:13px; transform-origin: -160px 0; }
    .circle-wrap { height:120px; }
    #centerText h1 { font-size:18px; }
    #centerText p { font-size:14px; }
  }
</style>
</head>
<body>
<div id="app">
  <canvas id="bg"></canvas>

  <div id="centerText" aria-hidden="true">
    <h1>Tuấn ♥️ Nga. Anh yêu em 💕😘</h1>
    <p>Bé iuuu của anh thêm tuổi mới rồi, bớt bướng 1 xíu nha 😆</p>
    <p>Chúc em luôn xinh đẹp, vui vẻ và hạnh phúc 💖</p>
    <p>Chúc em bé của anh sẽ thật mạnh mẽ trên con đường phía trước 💪🌸</p>
    <p>Sau này, em vẫn mãi là một phần đặc biệt trong tim anh ♥️💗</p>
    <p>Cảm ơn vì hai ta đã gặp nhau ở độ tuổi đẹp nhất 🫂💕</p>
  </div>

  <div class="circle-wrap" aria-hidden="true">
    <div class="rotater" id="rotater"></div>
  </div>
</div>

<!-- Audio: replace "your-song.mp3" with the mp3 you upload to repo (or a direct mp3 link) -->
<audio id="bgAudio" loop preload="auto" src="your-song.mp3"></audio>
<button id="musicBtn" class="hidden" title="Bật nhạc">
  ▶️ Phát nhạc
</button>

<!-- Three.js r128 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
/* ---------------- Scene setup ---------------- */
const canvas = document.getElementById('bg');
const renderer = new THREE.WebGLRenderer({ canvas, antialias:true, alpha:true });
renderer.setPixelRatio(window.devicePixelRatio || 1);
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.outputEncoding = THREE.sRGBEncoding;

const scene = new THREE.Scene();
scene.background = new THREE.Color(0x000000);
scene.fog = new THREE.FogExp2(0x000000, 0.0022);

const camera = new THREE.PerspectiveCamera(45, innerWidth/innerHeight, 0.1, 1000);
camera.position.set(0, 0, 60);

/* lights */
const amb = new THREE.AmbientLight(0x222222);
scene.add(amb);
const p1 = new THREE.PointLight(0xff8fbf, 1.2, 200);
p1.position.set(30, 30, 50);
scene.add(p1);
const p2 = new THREE.PointLight(0xbf7bff, 0.7, 200);
p2.position.set(-30, -10, 40);
scene.add(p2);

/* ---------------- Particles (heart) ---------------- */
const COUNT = 1600;
const geom = new THREE.BufferGeometry();
const positions = new Float32Array(COUNT * 3);
const base = new Float32Array(COUNT * 3);
const vel = new Float32Array(COUNT * 3);

/* heart param */
function heartParam(t, scale=8){
  const x = 16*Math.pow(Math.sin(t),3);
  const y = 13*Math.cos(t) - 5*Math.cos(2*t) - 2*Math.cos(3*t) - Math.cos(4*t);
  return [ (x/2) * scale, (y/2) * scale ];
}

/* initialize base heart positions */
for(let i=0;i<COUNT;i++){
  const t = (i/COUNT) * Math.PI * 2 + Math.random()*0.02;
  const p = heartParam(t, 1.2);
  const jx = (Math.random()-0.5) * 1.3;
  const jy = (Math.random()-0.5) * 0.6;
  const x = p[0] + jx;
  const y = p[1] + jy;
  const z = (Math.random()-0.5) * 2.4;
  base[i*3] = x;
  base[i*3+1] = y;
  base[i*3+2] = z;
  positions[i*3] = x;
  positions[i*3+1] = y;
  positions[i*3+2] = z;
  vel[i*3]=vel[i*3+1]=vel[i*3+2]=0;
}

geom.setAttribute('position', new THREE.BufferAttribute(positions, 3));
geom.setAttribute('base', new THREE.BufferAttribute(base, 3));
geom.setAttribute('vel', new THREE.BufferAttribute(vel, 3));

/* particle material — soft sprite for glow */
const dotUrl = 'https://i.imgur.com/7kS0YpH.png'; // soft round sprite (free imgur)
const sprite = new THREE.TextureLoader().load(dotUrl);
const mat = new THREE.PointsMaterial({
  size: (window.devicePixelRatio>1 ? 1.2 : 1) * 0.9,
  map: sprite,
  transparent: true,
  opacity: 0.95,
  blending: THREE.AdditiveBlending,
  depthWrite: false,
  color: new THREE.Color(0xff6fbf)
});
const points = new THREE.Points(geom, mat);
scene.add(points);

/* translucent heart mesh for depth (glow) */
const heartShape = new THREE.Shape();
heartShape.moveTo(0,0);
heartShape.bezierCurveTo(0,0,-2.4,-2.4,-2.4,-4.8);
heartShape.bezierCurveTo(-2.4,-7.2,0,-7.2,0,-4.8);
heartShape.bezierCurveTo(0,-7.2,2.4,-7.2,2.4,-4.8);
heartShape.bezierCurveTo(2.4,-2.4,0,0,0,0);
const extrude = new THREE.ExtrudeGeometry(heartShape, { depth: 2.2, bevelEnabled:true, bevelSize:0.3, bevelThickness:0.25, steps:2 });
const glowMat = new THREE.MeshPhongMaterial({ color:0xff3f9f, emissive:0xbf7bff, transparent:true, opacity:0.14, side: THREE.DoubleSide });
const heartMesh = new THREE.Mesh(extrude, glowMat);
heartMesh.scale.set(2.6, 2.6, 2.6);
heartMesh.rotation.y = Math.PI;
heartMesh.position.z = -6;
scene.add(heartMesh);

/* explosion control */
let clock = new THREE.Clock();
let lastExplode = -999;
const CYCLE = 5.0; // seconds
function doExplode(){
  for(let i=0;i<COUNT;i++){
    const bx = base[i*3], by = base[i*3+1], bz = base[i*3+2];
    // outward seed velocity
    const s = 1.5 + Math.random()*2.2;
    const vx = (bx + (Math.random()-0.5)*2) * s;
    const vy = (by + (Math.random()-0.5)*2) * s + (Math.random()-0.5)*4;
    const vz = (bz*0.3 + (Math.random()-0.5)*2) * s;
    vel[i*3]   = vx;
    vel[i*3+1] = vy;
    vel[i*3+2] = vz;
    // push initial positions slightly out so explosion looks immediate
    positions[i*3] += vel[i*3]*0.02;
    positions[i*3+1] += vel[i*3+1]*0.02;
    positions[i*3+2] += vel[i*3+2]*0.02;
  }
  lastExplode = clock.getElapsedTime();
}

/* initial tiny shimmer then explode */
setTimeout(()=> doExplode(), 700);

/* animation loop */
function animate(){
  requestAnimationFrame(animate);
  const t = clock.getElapsedTime();

  // trigger explosion cycle
  if(t - lastExplode > CYCLE) doExplode();

  // update particles
  const pos = geom.attributes.position.array;
  const b = geom.attributes.base.array;
  const v = geom.attributes.vel.array;

  for(let i=0;i<COUNT;i++){
    const i3 = i*3;
    // if recently exploded, velocities dominate, then damp and return
    v[i3] *= 0.96;
    v[i3+1] *= 0.94;
    v[i3+2] *= 0.96;
    pos[i3] += v[i3] * 0.02;
    pos[i3+1] += v[i3+1] * 0.02;
    pos[i3+2] += v[i3+2] * 0.02;

    // after ~2.2s begin to pull back to base
    const since = t - lastExplode;
    if(since > 2.2){
      pos[i3] += (b[i3] - pos[i3]) * 0.06;
      pos[i3+1] += (b[i3+1] - pos[i3+1]) * 0.06;
      pos[i3+2] += (b[i3+2] - pos[i3+2]) * 0.06;
    }
  }
  geom.attributes.position.needsUpdate = true;

  // rotate for 3D feel
  points.rotation.y += 0.0032;
  heartMesh.rotation.y += 0.0028;

  // color shift
  const c = new THREE.Color(0xff6fbf).lerp(new THREE.Color(0xbf7bff), (Math.sin(t*0.6)+1)/2);
  mat.color = c;

  renderer.render(scene, camera);
}
animate();

/* handle resize */
window.addEventListener('resize', ()=> {
  renderer.setSize(window.innerWidth, window.innerHeight);
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
});

/* ---------------- Rotating text (DOM) ---------------- */
const rot = document.getElementById('rotater');
const texts = [
  "Tuấn ♥️ Nga. Anh yêu em 💕😘",
  "Bé iuuu của anh thêm tuổi mới rồi, bớt bướng 1 xíu nha 😆",
  "Chúc em luôn xinh đẹp, vui vẻ và hạnh phúc 💖",
  "Chúc em bé của anh sẽ thật mạnh mẽ trên con đường phía trước 💪🌸",
  "Sau này, em vẫn mãi là một phần đặc biệt trong tim anh ♥️💗",
  "Cảm ơn vì hai ta đã gặp nhau ở độ tuổi đẹp nhất 🫂💕"
];
// repeat so it looks continuous
const REPEAT = 8;
const totalItems = texts.length * REPEAT;
const radius = Math.min(window.innerWidth * 0.38, 300);
for(let r=0;r<REPEAT;r++){
  for(let i=0;i<texts.length;i++){
    const idx = r*texts.length + i;
    const el = document.createElement('span');
    el.textContent = texts[i] + "    •    ";
    const angle = (idx / totalItems) * Math.PI * 2;
    const deg = angle * 180 / Math.PI;
    el.style.transform = `rotate(${deg}deg) translateX(${radius}px)`;
    rot.appendChild(el);
  }
}

/* ---------------- Audio autoplay handling ---------------- */
const audio = document.getElementById('bgAudio');
const musicBtn = document.getElementById('musicBtn');
function tryPlay(){
  audio.play().then(() => {
    musicBtn.classList.add('hidden');
  }).catch(()=> {
    // show button if blocked
    musicBtn.classList.remove('hidden');
  });
}
window.addEventListener('load', tryPlay);
musicBtn.addEventListener('click', ()=>{
  audio.play().catch(()=>{});
  musicBtn.classList.add('hidden');
});
// also attempt play on first interaction
window.addEventListener('pointerdown', ()=> {
  if(audio.paused) audio.play().catch(()=>{});
  musicBtn.classList.add('hidden');
}, {once:true});
</script>
</body>
</html>
